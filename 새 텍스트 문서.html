<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì—ì–´ì»¨ ë¦¬ëª¨ì»¨</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f5f7fa;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .panel {
    background: #fff;
    border-radius: 25px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    padding: 40px;
    width: 750px;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
  }
  .title {
    font-size: 1.5em;
    font-weight: 600;
  }
  .power-btn {
    background: none;
    border: none;
    font-size: 2em;
    color: #e74c3c;
    cursor: pointer;
  }
  .temps {
    display: flex;
    justify-content: space-around;
    margin-bottom: 30px;
  }
  .temp-block {
    text-align: center;
  }
  .temp-label {
    font-size: 1.2em;
    color: #777;
  }
  .temp-value {
    font-size: 3em;
    font-weight: 600;
    color: #007bff;
  }
  .humidity {
    font-size: 1em;
    color: #555;
    margin-top: 5px;
  }
  .mode-section, .fan-section {
    text-align: center;
    margin-bottom: 30px;
  }
  select {
    width: 220px;
    height: 60px;
    border-radius: 10px;
    font-size: 1.2em;
    text-align: center;
    border: 1px solid #ccc;
    background: #f9f9f9;
  }
  .control {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 30px;
  }
  .control button {
    width: 90px;
    height: 90px;
    margin: 0 20px;
    border: none;
    border-radius: 50%;
    background: #007bff;
    color: white;
    font-size: 2em;
    cursor: pointer;
    transition: 0.2s;
  }
  .control button:hover {
    background: #0056b3;
  }
</style>
</head>
<body>
  <div class="panel">
    <div class="header">
      <div class="title">ì‹¤ë‚´ê¸°</div>
      <button class="power-btn" onclick="togglePower()">â»</button>
    </div>

    <div class="temps">
      <div class="temp-block">
        <div class="temp-label">ì‹¤ë‚´ì˜¨ë„ (í˜„ìœ„ì¹˜)</div>
        <div class="temp-value" id="roomTemp">--Â°</div>
        <div class="humidity" id="roomHumidity">--%</div>
      </div>
      <div class="temp-block">
        <div class="temp-label">ì„¤ì •ì˜¨ë„</div>
        <div class="temp-value" id="setTemp">24.0Â°</div>
      </div>
    </div>

    <div class="mode-section">
      <label for="mode">ìš´ì „ëª¨ë“œ</label><br>
      <select id="mode" onchange="manualMode(this.value)">
        <option value="ìë™">ìë™</option>
        <option value="ëƒ‰ë°©">ëƒ‰ë°©</option>
        <option value="ë‚œë°©">ë‚œë°©</option>
        <option value="ì œìŠµ">ì œìŠµ</option>
        <option value="ì†¡í’">ì†¡í’</option>
      </select>
    </div>

    <div class="fan-section">
      <label for="fan">í’ì†</label><br>
      <select id="fan" onchange="changeFan(this.value)">
        <option value="ìë™">ìë™</option>
        <option value="ë¬´í’">ë¬´í’</option>
        <option value="ì•½">ì•½</option>
        <option value="ì¤‘">ì¤‘</option>
        <option value="ê°•">ê°•</option>
      </select>
    </div>

    <div class="control">
      <button onclick="tempDown()">âˆ’</button>
      <button onclick="tempUp()">ï¼‹</button>
    </div>
  </div>

  <!-- ğŸ”Š ì‚¬ìš´ë“œ íŒŒì¼ -->
  <audio id="soundOn" src="ON ë¶€ì €ìŒ.m4a" preload="auto"></audio>
  <audio id="soundOff" src="OFF ë¶€ì €ìŒ.m4a" preload="auto"></audio>
  <audio id="soundControl" src="ì œì–´ ë¶€ì €ìŒ.m4a" preload="auto"></audio>

  <script>
    let power = false;
    let setTemp = 24.0;
    let mode = "ìë™";
    let fan = "ìë™";
    let currentTemp = null;
    let currentHumidity = null;

    const MIN_TEMP = 18.0;
    const MAX_TEMP = 30.0;

    const soundOn = document.getElementById("soundOn");
    const soundOff = document.getElementById("soundOff");
    const soundControl = document.getElementById("soundControl");

    function playSound(type) {
      switch(type) {
        case "on": soundOn.currentTime = 0; soundOn.play(); break;
        case "off": soundOff.currentTime = 0; soundOff.play(); break;
        case "control": soundControl.currentTime = 0; soundControl.play(); break;
      }
    }

    function updateUI() {
      document.getElementById("setTemp").textContent = power ? Math.round(setTemp) + ".0Â°" : "--Â°";
      document.getElementById("mode").value = mode;
      document.getElementById("fan").value = fan;
    }

    function togglePower() {
      power = !power;
      playSound(power ? "on" : "off");
      updateUI();
    }

    function tempUp() {
      if (power && setTemp < MAX_TEMP) {
        setTemp += 0.5;
        if (setTemp > MAX_TEMP) setTemp = MAX_TEMP;
        playSound("control");
        updateUI();
      }
    }

    function tempDown() {
      if (power && setTemp > MIN_TEMP) {
        setTemp -= 0.5;
        if (setTemp < MIN_TEMP) setTemp = MIN_TEMP;
        playSound("control");
        updateUI();
      }
    }

    function manualMode(v) {
      if (power) {
        mode = v;
        playSound("control");
      }
    }

    function changeFan(v) {
      if (power) {
        fan = v;
        playSound("control");
      }
    }

    // ğŸŒ¡ï¸ ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸° (Open-Meteo, API Key ë¶ˆí•„ìš”)
    function getWeather() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m`)
            .then(response => response.json())
            .then(data => {
              currentTemp = data.current_weather.temperature;
              document.getElementById("roomTemp").textContent = Math.round(currentTemp) + ".0Â°";

              let nowIndex = data.hourly.time.indexOf(data.current_weather.time);
              if (nowIndex !== -1) {
                currentHumidity = data.hourly.relativehumidity_2m[nowIndex];
                document.getElementById("roomHumidity").textContent = currentHumidity + "%";
              }
              if (mode === "ìë™") autoControl();
            })
            .catch(() => {
              document.getElementById("roomTemp").textContent = "ì˜¤ë¥˜";
              document.getElementById("roomHumidity").textContent = "--%";
            });
        }, () => {
          document.getElementById("roomTemp").textContent = "ìœ„ì¹˜ í—ˆìš© í•„ìš”";
          document.getElementById("roomHumidity").textContent = "--%";
        });
      } else {
        document.getElementById("roomTemp").textContent = "ì§€ì› ì•ˆë¨";
        document.getElementById("roomHumidity").textContent = "--%";
      }
    }

    // ğŸ¤– ìë™ ëª¨ë“œ ì œì–´ ë¡œì§ (ì œìŠµ í¬í•¨)
    function autoControl() {
      if (!power || currentTemp === null) return;

      if (currentTemp >= 24) {
        mode = "ëƒ‰ë°©";
        fan = currentTemp >= 30 ? "ê°•" : (currentTemp >= 27 ? "ì¤‘" : "ì•½");
      } else if (currentTemp <= 15) {
        mode = "ë‚œë°©";
        fan = currentTemp <= 5 ? "ê°•" : (currentTemp <= 10 ? "ì¤‘" : "ì•½");
      } else {
        if (currentHumidity !== null && currentHumidity >= 65) {
          mode = "ì œìŠµ";
          fan = currentHumidity >= 80 ? "ê°•" : "ì¤‘";
        } else {
          mode = "ì†¡í’";
          fan = "ë¬´í’";
        }
      }
      updateUI();
    }

    // 1ë¶„ë§ˆë‹¤ ë‚ ì”¨ ê°±ì‹ 
    getWeather();
    setInterval(getWeather, 60000);
  </script>
</body>
</html>
